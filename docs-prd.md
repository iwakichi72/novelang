# Novelang PRD＋基本設計

> このドキュメントは実装前の要件定義・基本設計である。計画承認後に実装フェーズへ移行する。

---

## 0. 不足情報の質問（最大10問）

以下は理想的には回答が欲しい項目。未回答でも前提を置いて進める。

1. **ターゲット市場**: 日本在住の日本人が主か、グローバルか？ → **前提: 日本人向け（UI日本語）**
2. **収益モデル**: サブスク？広告？買い切り？ → **前提: フリーミアム＋月額サブスク**
3. **チーム構成**: hunteが1人で開発？ → **前提: hunteが1人で開発、デザインは最小限**
4. **初期コンテンツ数**: MVP時に何作品必要？ → **前提: 3〜5作品（パブリックドメイン）**
5. **予算上限**: LLM/TTS等のランニングコスト上限は？ → **前提: MVP期間は月$50以下**
6. **ネイティブ vs Web**: 過去のモバイル開発経験は？ → **前提: Web技術メイン、PWAで開始**
7. **音声の重要度**: MVPに必須か？ → **前提: MVP Phase2（β）で追加、初期MVPでは省略可**
8. **認証プロバイダ**: 既存のAWSアカウントを使うか？ → **前提: AWS Cognito（Google/Apple Sign-In）**
9. **作品ジャンル**: 児童文学？SF？古典？ → **前提: 古典＋児童文学（PD作品中心）**
10. **対象英語レベル**: CEFR A2〜B2？ → **前提: A2〜B2を主対象、難易度タグで対応**

---

## (1) PRD（Product Requirements Document）

### プロダクト概要

Novelangは、英語の小説を"挫折せずに"読み通すための多読支援Webアプリである。文単位の日英切替、英語量のグラデーション調整、ワンタップAI辞書により、「分からない→止まる→やめる」のループを「分からない→すぐ助かる→読み続ける」に変換する。漫画多読アプリLangakuの体験を、テキストコンテンツに最適化して再構成したもの。

### ペルソナ＋Jobs to be Done

| # | ペルソナ | 属性 | JTBD |
|---|---------|------|------|
| 1 | **ユキ（大学生・TOEIC 500）** | 20歳、英語は苦手意識あり、洋書に憧れるが1ページで挫折 | 「自分のレベルでも洋書を1冊読み切った」という成功体験を得たい |
| 2 | **タケシ（社会人・TOEIC 700）** | 32歳、通勤時間に英語力を維持したい、Kindleで洋書を買うが積読 | 隙間時間で無理なく英語に触れ続けたい。辞書を引く手間で中断したくない |
| 3 | **マイコ（主婦・英語やり直し）** | 45歳、子供の英語教育がきっかけで自分も学び直し、小説好き | 好きな物語を楽しみながら英語を自然に身につけたい |

### コア体験ループ

```
読む → 詰まる → 助ける → 続く → 達成感 → また読む
```

1. **読む**: 英語テキストが画面に表示される。英語量は自分のレベルに合わせて調整済み（例: 50%英語・50%日本語）
2. **詰まる**: 知らない単語や文に出会う
3. **助ける**: 文をタップで日本語に切替。単語をタップで辞書（通常＋AI）が即座にポップアップ。文脈付きの説明で理解
4. **続く**: 理解できたのでそのまま次の文へ。ページ送りは滑らかに
5. **達成感**: 章の読了でプログレスバー更新。連続日数のカウント。「今日は12ページ読んだ」
6. **また読む**: 翌日、しおりから即再開。未読通知やストリーク維持の動機で戻ってくる

### 主要ユースケース（ユーザーストーリー10本）

#### US-01: アカウント作成
> ユーザーとして、Google/Appleアカウントでワンタップ登録したい。メール登録は面倒なので。
- **受入条件**: Google/Apple Sign-In → アカウント生成 → オンボーディング画面へ遷移。3タップ以内。

#### US-02: 英語レベル設定
> 新規ユーザーとして、最初に自分の英語レベルを申告したい。適切な英語量で始めるために。
- **受入条件**: 4段階（初心者/初中級/中級/中上級）から選択。後から変更可能。選択後にオススメ作品が表示される。

#### US-03: 作品を選んで読み始める
> ユーザーとして、作品一覧から興味のある本を選び、すぐに読み始めたい。
- **受入条件**: 作品カード（表紙・タイトル・難易度・あらすじ）一覧表示。タップで第1章の読書画面へ。

#### US-04: 英語量を調整して読む
> ユーザーとして、自分に合った英語量（100%/75%/50%/25%）で読みたい。
- **受入条件**: 読書画面のスライダーで4段階切替。変更は即座に反映（リロード不要）。100%=全文英語、25%=重要文のみ英語・他は日本語。

#### US-05: 文をタップして日英切替
> ユーザーとして、分からない英文をタップして日本語訳を見たい。もう一度タップで英語に戻したい。
- **受入条件**: 文単位でタップ → 日本語訳に切替（アニメーション0.2秒以内）。再タップで英語に戻る。

#### US-06: 単語タップ辞書
> ユーザーとして、分からない単語を長押しして意味を確認したい。
- **受入条件**: 長押し → ポップアップに①単語の意味（辞書データ）②発音記号③文脈に合った説明（AI辞書、オプション）。ポップアップ表示1秒以内。

#### US-07: 単語を単語帳に保存
> ユーザーとして、辞書ポップアップから単語を保存して後で復習したい。
- **受入条件**: ポップアップ内の「＋」ボタンで保存。単語帳画面で一覧表示。出現した文のコンテキスト付き。

#### US-08: 読書進捗の確認
> ユーザーとして、どこまで読んだか、どれだけ読んだかを確認したい。
- **受入条件**: 読書画面にプログレスバー。ホーム画面に「今日の読書量」「連続日数」「読了作品数」表示。

#### US-09: しおり＆続きから読む
> ユーザーとして、アプリを閉じても次に開いた時に続きから読みたい。
- **受入条件**: 最後に読んだ位置を自動保存。アプリ起動時に「続きから読む」ボタン。手動しおりも可（複数可）。

#### US-10: 読了と次の作品
> ユーザーとして、1冊読了したら達成感を感じ、次の作品を選びたい。
- **受入条件**: 最終章読了 → 読了画面（総読書時間・調べた単語数・読了日）。「次にオススメ」表示。

### 競合/代替と勝ち筋

| 競合 | 長所 | Novelangの勝ち筋 |
|------|------|-------------------|
| **Kindle + Word Wise** | 圧倒的な書籍数。Word Wiseで簡易注釈 | Word Wiseは単語注釈のみ。文レベルの日英切替・英語量調整がない。挫折しやすい |
| **LingQ** | 単語の学習管理が強力。多言語対応 | UIが複雑で学習アプリ感が強い。「読書体験」より「学習ツール」。Novelangは読書の快適さ優先 |
| **Langaku** | 漫画で多読、UIが優れている | 漫画のみ。小説を読みたい人にはコンテンツが合わない |
| **対訳本/リーダー** | 紙でオフライン | インタラクティブ性ゼロ。英語量調整不可 |

**Novelangの核心的差別化**: 英語量のグラデーション調整（100%→25%を文単位でシームレスに切替）。これは既存のどのプロダクトにもない。

### KPI

| 指標 | 種別 | 定義 |
|------|------|------|
| **週間読書文数** | 北極星 | ユーザーが1週間に読んだ英文の数（日本語に切替えた文も含む） |
| DAU/WAU | エンゲージメント | 日次/週次アクティブユーザー |
| 平均セッション時間 | エンゲージメント | 読書画面滞在時間 |
| 章読了率 | リテンション | 開始した章を最後まで読んだ割合 |
| 7日継続率 | リテンション | 初回読書から7日以内に再訪した割合 |
| 英語量レベル上昇率 | 学習効果 | 25%→50%など、英語量を上げたユーザーの割合 |
| サブスク転換率 | 収益 | 無料→有料の転換率 |

**計測イベント案**:
- `reading_session_start`, `reading_session_end`
- `sentence_tap_translate` (文タップ翻訳)
- `word_lookup` (辞書参照)
- `word_saved` (単語保存)
- `english_ratio_changed` (英語量変更)
- `chapter_completed`, `book_completed`
- `streak_updated` (連続日数更新)

### スコープ

| MVP (2週間) | 次フェーズ β (4週間) | やらないこと |
|-------------|---------------------|-------------|
| PD作品3〜5冊 | TTS音声読み上げ | ユーザー投稿コンテンツ |
| 読書ビュー（英語量4段階） | オートスクロール/集中モード | SNS機能/コミュニティ |
| 文タップ日英切替 | AI辞書（LLM） | ライティング練習 |
| 基本辞書（ローカル辞書データ） | 単語復習（フラッシュカード） | 文法解説 |
| 単語帳（保存のみ） | オフライン対応 | リアルタイム対戦 |
| 進捗＆しおり | プッシュ通知 | 翻訳品質の手動修正UI |
| Google/Apple認証 | サブスク課金 | 出版社との版権契約（MVP） |
| 連続日数・読了バッジ | 検索機能 | |

### リスク

| リスク | 影響 | 緩和策 |
|--------|------|--------|
| **著作権** | 法的問題。サービス停止 | MVPはパブリックドメイン作品（Project Gutenberg等）のみ。将来はCC/ライセンス契約 |
| **翻訳品質** | UX低下。誤訳による学習効果誤認 | MVPは人手翻訳済みのPD作品を使用。機械翻訳はフォールバック |
| **AIコスト** | AI辞書のAPI費用が膨らむ | キャッシュ強化。同一単語+文脈のキャッシュヒット率を上げる。レート制限 |
| **コンテンツ不足** | 作品が少なく飽きる | PD作品は大量にある。短編から開始しハードルを下げる |
| **学習効果誤認** | 「読めた気」になるだけで力がつかないとの批判 | 「多読量を増やす」を目的と明示。学習効果の保証はしない。英語量を徐々に上げる仕組みで成長を促す |
| **1人開発の限界** | スケジュール遅延 | MVPを極限まで絞る。3rd partyサービス活用 |

---

## (2) 機能要件（MVP中心）

### 2-1. 読書ビュー

- **表示単位**: 章 > 段落 > 文。スクロール型（ページ送り型は将来オプション）
- **フォント**: 可変。デフォルト16px、14〜24px調整可
- **背景**: 白/セピア/ダーク の3種
- **行間**: 1.6〜2.0em（読みやすさ重視）

### 2-2. 日英切替

- **粒度**: **文（sentence）単位** を推奨
  - 段落単位: 粒度が粗すぎる。分からない文が1つでも段落全体を日本語にしてしまう
  - 単語単位: 粒度が細かすぎる。文脈が崩れる
  - **文単位がベストバランス**: 必要な箇所だけ切替えられ、文脈も保たれる
- **操作**: タップで英→日、再タップで日→英
- **視覚**: 日本語表示中は薄い背景色（例: 淡い青）で区別

### 2-3. 英語量調整（4段階）

| レベル | 英語率 | ロジック |
|--------|--------|---------|
| Level 4 | 100% | 全文英語 |
| Level 3 | 75% | 難易度上位25%の文を日本語に置換 |
| Level 2 | 50% | 難易度上位50%の文を日本語に |
| Level 1 | 25% | 易しい文のみ英語、残りは日本語 |

**アルゴリズム案**:
- 各文に「難易度スコア」を事前計算（語彙レベル・文長・構文複雑度の加重平均）
- 難易度スコアの高い文から優先的に日本語に置換
- スコア計算は作品登録時にバッチ処理（ランタイムではない）

**難易度スコアの要素**:
- 語彙レベル: 各単語のCEFRレベル（A1=1, C2=6）の平均
- 文長: 単語数（長い文ほど難しい）
- 構文: 従属節の数、受動態の有無（簡易パース）

### 2-4. 単語タップ辞書

**2層構成**:

| 層 | データソース | 表示内容 | 速度 | コスト |
|----|-------------|---------|------|--------|
| 第1層: 基本辞書 | ローカル辞書データ（EJDICT等のフリー辞書） | 意味・品詞・発音記号 | 即座 | 無料 |
| 第2層: AI辞書 | LLM API (Claude Haiku等) | 文脈に合った意味・例文・ニュアンス解説 | 1-2秒 | API費用 |

**表示UX**:
1. 単語長押し → 即座にポップアップ（第1層）
2. ポップアップ内「詳しく」ボタン → AI辞書を呼び出し（第2層）
3. ポップアップ内「＋」ボタン → 単語帳に保存

**キャッシュ**: 同一単語＋同一文の組み合わせでキャッシュ（Supabase or ローカル）。再問い合わせ不要。

**回数制限（MVP）**: なし。ただしレート制限は設ける（1分あたり20回）。サブスク後に制限緩和を検討。

### 2-5. 音声（TTS）— β以降

- **範囲**: 文単位の読み上げ（タップした文を読む）
- **再生速度**: 0.75x / 1.0x / 1.25x
- **MVP推奨**: ブラウザ内蔵 Web Speech API（コスト$0）。品質が必要ならAmazon Polly（Neural）へ移行
- **段落/章の連続読み上げ**: β後半

### 2-6. オート再生/オートスクロール — β以降

- TTS連続再生＋自動スクロール。読み上げている文をハイライト。
- 集中モードとして提供。

### 2-7. 語彙の保存＋復習

- **MVP**: 単語帳への保存（単語・意味・出現文）。一覧表示。
- **β**: フラッシュカード（文脈付き）。間隔反復は将来。

### 2-8. 進捗

- **読了率**: 章ごとのプログレスバー（読んだ文数/総文数）
- **しおり**: 自動（最終位置）＋手動（複数可）
- **ハイライト**: β以降
- **継続**: 連続読書日数（ストリーク）、今日の読書量

### 2-9. オンボーディング

1. Google/Apple Sign-In
2. 英語レベル自己申告（4択: 初心者/初中級/中級/中上級）
3. デフォルト英語量設定（初心者→Level1, 中上級→Level3）
4. オススメ作品表示 → タップで読書開始

### 2-10. 検索

- **MVP**: 作品検索（タイトル・著者）のみ
- **β**: 章内テキスト検索

---

## (3) 非機能要件

### パフォーマンス

| 指標 | 目標 |
|------|------|
| 初回表示（読書画面） | 2秒以内 |
| ページスクロール | 60fps |
| 文タップ→日英切替 | 0.2秒以内 |
| 基本辞書表示 | 0.5秒以内 |
| AI辞書表示 | 2秒以内 |

### オフライン

- **MVP**: オンライン必須。章データはブラウザキャッシュ（Service Worker）で軽くキャッシュ
- **β**: 章単位のオフラインキャッシュ（IndexedDB）。AI辞書はオンライン必須

### セキュリティ/プライバシー

- 認証: Supabase Auth (JWT)
- HTTPS必須
- 学習履歴はサーバー保存（ユーザーに紐付け）
- 個人情報: メールアドレスのみ。GDPR対応（削除機能）は初期版で対応
- API: JWTトークンによる認証。CORS設定

### 運用

- ログ: CloudWatch Logs
- 障害時: 静的フォールバック画面。読書データはローカルにも保持し、復旧後に同期
- 監視: CloudWatch Alarms（エラー率、レイテンシ）

### 多言語

- MVP: UI日本語のみ
- 将来: UIの多言語対応（i18n対応の構造は最初から入れておく）
- コンテンツ: 英語→日本語訳のみ。将来は他言語ペア

---

## (4) コンテンツ要件

### 著作権の前提

| 選択肢 | MVP適合度 | 備考 |
|--------|----------|------|
| **A: パブリックドメイン（推奨）** | ◎ | Project Gutenberg（英語原文）。日本語訳は死後70年超の翻訳 or 新規機械翻訳 |
| B: CCライセンス作品 | ○ | 作品数が限られる |
| C: 出版社ライセンス | × (MVPでは非現実的) | 交渉に時間とコストが必要 |
| D: 自作/委託コンテンツ | △ | コスト高、作品の魅力が不確実 |

**MVP現実解**: パブリックドメイン作品（Project Gutenberg）の英語原文を使用。日本語訳は以下の2段構え:
1. 既存のPD日本語訳があればそれを使用（青空文庫等）
2. なければLLMで機械翻訳し、文アラインメント付きでDB格納（事前バッチ処理）

**MVP作品候補**:
- *The Happy Prince* (Oscar Wilde) — 短編、A2-B1
- *Alice's Adventures in Wonderland* (Lewis Carroll) — B1
- *The Gift of the Magi* (O. Henry) — 短編、B1
- *A Christmas Carol* (Charles Dickens) — B1-B2
- *The Great Gatsby* (F. Scott Fitzgerald) — B2 （※2021年PD化）

### 作品メタデータ設計

```
Book:
  - title_en, title_ja
  - author_en, author_ja
  - cover_image_url
  - description_ja (あらすじ)
  - cefr_level (A2/B1/B2等)
  - total_chapters, total_sentences, total_words
  - genre_tags[]
  - source_url (Gutenberg等)
  - license_type (PUBLIC_DOMAIN/CC/LICENSED)

Chapter:
  - chapter_number
  - title_en, title_ja
  - sentence_count, word_count

Sentence:
  - position (章内の順序)
  - text_en (英語原文)
  - text_ja (日本語訳)
  - difficulty_score (0.0〜1.0)
  - word_count
  - cefr_estimate
```

### 翻訳データの持ち方

**推奨: 全文固定訳（事前生成）**

| 選択肢 | 推奨度 | 理由 |
|--------|--------|------|
| **A: 全文固定訳（推奨）** | ◎ | レスポンス即座。品質管理可能。コスト予測可能。オフライン対応可 |
| B: 機械翻訳オンデマンド | △ | レイテンシ発生。コスト変動。品質不安定 |

固定訳は作品登録時のバッチ処理でLLMにより生成。人手レビューは将来的にクラウドソーシング等で対応。

### 文アラインメント（英語量調整に必要）

- 英語原文と日本語訳を**文単位で1:1対応**させる
- 処理パイプライン:
  1. 英語原文を文分割（spaCy or ルールベース: ピリオド・疑問符・感嘆符で分割）
  2. LLMに「各英文に対応する日本語訳を1文ずつ生成」と指示
  3. 結果をSentenceテーブルに格納（text_en, text_ja ペア）
  4. 各文にdifficulty_scoreを計算して格納
- これにより、英語量調整時に文単位でen/jaを切替えるだけで済む

---

## (5) 情報設計・画面設計

### 主要画面一覧（サイトマップ）

```
/ (ランディング/ログイン)
├── /onboarding (レベル設定)
├── /home (ホーム: 続きから読む、おすすめ、統計)
├── /library (作品一覧)
│   └── /library/:bookId (作品詳細)
├── /read/:bookId/:chapterId (読書画面) ★最重要
├── /vocab (単語帳)
├── /stats (読書統計)
└── /settings (設定: 英語量デフォルト、フォント、テーマ、アカウント)
```

### 画面ごとの要点

#### ホーム画面 `/home`
- 上部: 「続きから読む」カード（最後に読んでいた作品+章、プログレス）
- 中部: 今日の読書統計（読んだ文数、連続日数）
- 下部: おすすめ作品カルーセル

#### 作品一覧 `/library`
- カード型グリッド（表紙、タイトル、難易度バッジ、ジャンルタグ）
- フィルタ: 難易度、ジャンル
- ソート: おすすめ順、難易度順

#### 読書画面 `/read/:bookId/:chapterId` ★詳細

```
┌─────────────────────────────────┐
│ ← 戻る    Chapter 3    ⚙設定   │  ← ヘッダー（タップで表示/非表示）
├─────────────────────────────────┤
│                                 │
│  It was a bright cold day in    │  ← 英語文（タップで日本語に切替）
│  April, and the clocks were     │
│  striking thirteen.             │
│                                 │
│  四月の明るく寒い日で、時計は    │  ← 日本語に切替済みの文（淡い背景）
│  13時を打っていた。              │
│                                 │
│  Winston Smith, his chin        │  ← 英語文
│  nuzzled into his breast...     │
│                                 │
│  [... スクロール ...]            │
│                                 │
├─────────────────────────────────┤
│ ■■■■■■■□□□□□□  38%             │  ← プログレスバー
│ 英語量: [====○------] 50%       │  ← 英語量スライダー
└─────────────────────────────────┘

辞書ポップアップ（単語長押し時）:
┌─────────────────────────────────┐
│ nuzzled  /ˈnʌz.əld/            │
│ 動詞: 鼻を押し付ける、すり寄る   │
│                                 │
│ [詳しく（AI辞書）]  [＋ 保存]    │
└─────────────────────────────────┘
```

- **ヘッダー**: 通常時は非表示（没入感）。画面上部タップで表示
- **文タップ**: 英→日切替。トグル式
- **単語長押し**: 辞書ポップアップ
- **スワイプ左**: 次の章（章末に到達時）
- **設定歯車**: フォントサイズ、テーマ、英語量、しおり追加

#### 単語帳 `/vocab`
- 保存した単語一覧（単語、意味、出現文の抜粋）
- βでフラッシュカード機能追加

### ユーザーフロー

#### フロー1: 初回→読書開始
```
ランディング → Google Sign-In → レベル選択（4択）
→ おすすめ作品表示 → 作品タップ → 作品詳細（あらすじ・難易度）
→ 「読み始める」ボタン → 読書画面（Chapter 1、英語量はレベルに応じたデフォルト）
```

#### フロー2: 読書中→辞書→単語帳
```
読書画面で英文を読む → 知らない単語を長押し → 辞書ポップアップ表示
→ 「詳しく」タップ → AI辞書の文脈説明表示（1-2秒）
→ 「＋保存」タップ → 「保存しました」トースト → 読書に戻る
→ 後で単語帳画面で復習
```

---

## (6) データモデル案（ERD）

### エンティティと関係

```
User (PK: user_id UUID)
  - email, display_name, auth_provider (GOOGLE/APPLE)
  - cefr_level (A2/B1/B2/C1)
  - default_english_ratio (25/50/75/100)
  - created_at, updated_at

Book (PK: book_id UUID)
  - title_en, title_ja, author_en, author_ja
  - cover_image_url, description_ja
  - cefr_level, genre_tags (JSON)
  - total_chapters, total_sentences, total_words
  - license_type, source_url
  - created_at

Chapter (PK: chapter_id UUID, FK: book_id)
  - book_id → Book
  - chapter_number, title_en, title_ja
  - sentence_count, word_count

Sentence (PK: sentence_id UUID, FK: chapter_id)
  - chapter_id → Chapter
  - position (章内順序)
  - text_en, text_ja
  - difficulty_score (DECIMAL 0.0-1.0)
  - word_count, cefr_estimate
  INDEX: (chapter_id, position) — 章の文を順番に取得
  INDEX: (chapter_id, difficulty_score) — 英語量調整の閾値計算

WordEntry (PK: word_id UUID)
  - word (英単語、正規化済み)
  - pos (品詞)
  - meaning_ja (基本辞書の意味)
  - pronunciation (発音記号)
  - cefr_level
  INDEX: (word) UNIQUE — 単語検索

AIDictionaryCache (PK: cache_id UUID)
  - word → WordEntry.word
  - sentence_id → Sentence (文脈)
  - response_ja (AI辞書の回答)
  - created_at
  INDEX: (word, sentence_id) UNIQUE — キャッシュヒット

VocabItem (PK: vocab_id UUID, FK: user_id)
  - user_id → User
  - word_id → WordEntry
  - sentence_id → Sentence (出現文脈)
  - note (ユーザーメモ、オプション)
  - created_at
  INDEX: (user_id, created_at) — 単語帳一覧

ReadingProgress (PK: progress_id UUID, FK: user_id, book_id)
  - user_id → User
  - book_id → Book
  - current_chapter_id → Chapter
  - current_sentence_position (最後に読んだ文の位置)
  - english_ratio (この作品での英語量設定)
  - sentences_read (読了文数)
  - is_completed (BOOL)
  - last_read_at
  INDEX: (user_id, last_read_at) — 「続きから読む」取得
  INDEX: (user_id, book_id) UNIQUE

Bookmark (PK: bookmark_id UUID, FK: user_id)
  - user_id → User
  - sentence_id → Sentence
  - note (オプション)
  - created_at

ReadingSession (PK: session_id UUID, FK: user_id)
  - user_id → User
  - book_id → Book
  - started_at, ended_at
  - sentences_read (このセッションで読んだ文数)
  - words_looked_up (辞書参照数)

DailyStats (PK: user_id + date)
  - user_id → User
  - date
  - sentences_read, minutes_read
  - streak_days (連続日数)
  INDEX: (user_id, date) — 日次統計取得
```

---

## (7) API設計案

### 認証

**推奨: Supabase Auth + Google/Apple Sign-In**

```
POST /auth/google   — Googleトークンで認証 → JWT発行
POST /auth/apple    — Appleトークンで認証 → JWT発行
POST /auth/refresh  — リフレッシュトークンでJWT再発行
DELETE /auth        — アカウント削除
```

### 作品

```
GET  /books                        — 作品一覧（フィルタ: cefr_level, genre）
GET  /books/:bookId                — 作品詳細
GET  /books/:bookId/chapters       — 章一覧
GET  /books/:bookId/chapters/:chapterId/sentences
                                    — 章の全文取得（text_en, text_ja, difficulty_score）
```

### 進捗

```
GET  /users/me/progress             — 全作品の進捗一覧
GET  /users/me/progress/:bookId     — 特定作品の進捗
PUT  /users/me/progress/:bookId     — 進捗更新（current_sentence_position, english_ratio等）
```

### 辞書

```
GET  /dictionary/:word              — 基本辞書（ローカルキャッシュ優先）
POST /dictionary/ai                 — AI辞書（{ word, sentence_id }）
     レート制限: 20回/分/ユーザー
```

### 単語帳

```
GET    /users/me/vocab              — 単語帳一覧（ページネーション）
POST   /users/me/vocab              — 単語保存（{ word_id, sentence_id }）
DELETE /users/me/vocab/:vocabId     — 単語削除
```

### しおり

```
GET    /users/me/bookmarks                 — しおり一覧
POST   /users/me/bookmarks                 — しおり追加（{ sentence_id }）
DELETE /users/me/bookmarks/:bookmarkId     — しおり削除
```

### 統計

```
GET /users/me/stats                 — 読書統計（総文数、ストリーク等）
GET /users/me/stats/daily?from=&to= — 日次統計
```

### セッション

```
POST /reading-sessions              — セッション開始
PUT  /reading-sessions/:sessionId   — セッション更新/終了
```

---

## (8) 技術方針

### プラットフォーム

| 選択肢 | 推奨度 | 理由 |
|--------|--------|------|
| **A: Next.js (PWA)（推奨）** | ◎ | hunteがWeb技術に親和性あり。PWAでモバイルにもインストール可。1コードベース。開発速度最速 |
| B: Flutter | ○ | クロスプラットフォーム。ただし学習コスト |
| C: React Native | ○ | JSだが、ネイティブ固有の問題が多い |
| D: Swift/Kotlin | × | 2プラットフォーム開発は1人では非現実的 |

**推奨構成**:
- **フロントエンド**: Next.js 15 (App Router) + TypeScript + Tailwind CSS
- **バックエンド**: Next.js API Routes（初期）→ AWS Lambda + API Gateway（スケール時）
- **DB**: Supabase (PostgreSQL)。RDBの方がデータモデル（文アラインメント、進捗管理等）に自然にフィット。無料枠あり。認証機能も内蔵だがCognito併用も可
- **認証**: Supabase Auth（Google/Apple Sign-In対応。Cognito不要でシンプルに）
- **ホスティング**: Vercel（Next.jsに最適化、無料枠で十分）
- **ストレージ**: S3（表紙画像等）

### AI辞書/翻訳のLLM

- **AI辞書**: Amazon Bedrock Claude Haiku (`us.anthropic.claude-haiku-4-5-20251001-v1:0`)
  - 入力: 単語+文のコンテキスト（約200トークン）
  - 出力: 文脈に合った説明（約150トークン）
  - **コスト概算**: 1リクエスト ≈ $0.0003（入力$0.8/1M, 出力$4/1Mとして）
  - 1日100回利用 × 30日 = $0.9/月/ユーザー
  - **キャッシュ戦略**: Supabaseにword+sentence_idでキャッシュ。同一クエリは再呼び出ししない

- **翻訳（バッチ）**: 作品登録時にClaude Sonnetで一括翻訳
  - 小説1冊（5万語 ≈ 70Kトークン）の翻訳コスト ≈ $0.50-1.00
  - 5冊で$5以下。MVP予算内

### TTS

| 選択肢 | MVP推奨度 | コスト |
|--------|----------|--------|
| **A: Web Speech API（推奨）** | ◎ | $0。ブラウザ内蔵。品質はそこそこ |
| B: Amazon Polly (Neural) | ○ | $16/100万文字。品質高い |
| C: OpenAI TTS | ○ | $15/100万文字。最高品質 |

**MVP**: Web Speech API。βでPollyに移行を検討。

### ログ/分析

- **ツール**: AWS CloudWatch + カスタムイベント（フロントからAPI経由で送信）
- **イベント名例**:
  - `app.session.start`, `app.session.end`
  - `reading.session.start`, `reading.session.end`
  - `reading.sentence.tap_translate`
  - `reading.english_ratio.change`
  - `dictionary.basic.lookup`, `dictionary.ai.lookup`
  - `vocab.save`, `vocab.delete`
  - `chapter.complete`, `book.complete`
  - `streak.update`

---

## (9) 作業計画

### マイルストーン

| 期間 | マイルストーン | 成果物 |
|------|--------------|--------|
| **Week 1-4: MVP** | 読める最小限 | PD作品3冊登録。読書画面（英語量4段階、文タップ切替）。基本辞書。進捗保存。Google認証（Supabase Auth）。Vercelデプロイ |
| **Week 5-8: β** | 続けられる体験 | AI辞書。単語帳。TTS（Web Speech API）。ストリーク/統計。オフラインキャッシュ。追加作品2冊 |
| **Week 9-12: 初期版** | 公開できる品質 | Apple認証。サブスク（Stripe）。プッシュ通知。検索。UIポリッシュ。パフォーマンス改善。計10作品 |

### バックログ（Must/Should/Could）

| # | 優先度 | チケット |
|---|--------|---------|
| 1 | Must | プロジェクトセットアップ（Next.js + TypeScript + Tailwind） |
| 2 | Must | Supabaseテーブル設計＋作成 |
| 3 | Must | Supabase Auth設定＋Google Sign-In実装 |
| 4 | Must | 作品データ投入パイプライン（Gutenberg→文分割→翻訳→DB格納） |
| 5 | Must | 文の難易度スコア計算バッチ |
| 6 | Must | 作品一覧API＋画面 |
| 7 | Must | 作品詳細API＋画面 |
| 8 | Must | 章の文取得API |
| 9 | Must | 読書画面（スクロール＋文表示） |
| 10 | Must | 英語量スライダー＋文の英日切替ロジック |
| 11 | Must | 文タップ日英切替 |
| 12 | Must | 基本辞書データ投入（EJDICT等） |
| 13 | Must | 単語長押し→辞書ポップアップ |
| 14 | Must | 読書進捗API（保存/取得） |
| 15 | Must | 自動しおり（最終位置保存） |
| 16 | Must | ホーム画面（続きから読む） |
| 17 | Must | Vercelデプロイ＋本番環境構築 |
| 18 | Should | AI辞書API（Bedrock Claude Haiku連携） |
| 19 | Should | AI辞書キャッシュ（Supabase） |
| 20 | Should | 単語帳CRUD API＋画面 |
| 21 | Should | TTS（Web Speech API連携） |
| 22 | Should | 連続日数（ストリーク）計算＋表示 |
| 23 | Should | 読書統計画面 |
| 24 | Should | オンボーディングフロー（レベル選択→おすすめ） |
| 25 | Should | Service Workerによるオフラインキャッシュ |
| 26 | Should | Apple Sign-In |
| 27 | Should | 手動しおり（複数） |
| 28 | Could | サブスク課金（Stripe） |
| 29 | Could | プッシュ通知（連続日数リマインド） |
| 30 | Could | 作品内テキスト検索 |
| 31 | Could | フラッシュカード（単語復習） |
| 32 | Could | オートスクロール/集中モード |
| 33 | Could | テーマ切替（白/セピア/ダーク） |
| 34 | Could | フォントサイズ調整 |
| 35 | Could | 読了画面＋次作品レコメンド |

---

以上がNovelangのPRD＋基本設計です。
